<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>服務商網路平台 | Service Provider Portal</title>

  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --spn-navy:#111820;
      --spn-orange:#ff9900;
      --spn-orange-strong:#ff7a00;
      --spn-yellow:#ffd814;
      --border-light:#e5e7eb;
      --bg-page:#f5f5f7;
    }

    body{
      background:var(--bg-page);
      font-family:'PingFang TC','Microsoft JhengHei',system-ui,-apple-system,sans-serif;
      color:#111827;
    }

    /* ========= NAV ========= */
    .headbar{
      background:var(--spn-navy);
      color:#fff;
      padding:8px 0;
    }
    .brand-logo{
      display:flex;
      align-items:center;
      font-weight:700;
      font-size:1.1rem;
      letter-spacing:.02em;
    }
    .brand-logo span{
      color:var(--spn-orange);
      margin-left:2px;
    }

    .nav-left-group{
      display:flex;
      align-items:center;
      gap:1.25rem;
      min-width:0;
    }

    .site-select-wrapper{
      display:flex;
      align-items:center;
      gap:.3rem;
      font-size:.8rem;
      color:#e5e7eb;
      white-space:nowrap;
    }
    .site-select-icon{
      font-size:1rem;
      color:#fff;
    }
    .site-select-control{
      background:#18212f;
      color:#f9fafb;
      border:1px solid #4b5563;
      border-radius:999px;
      padding:.1rem .75rem;
      font-size:.75rem;
    }
    .site-select-control:focus{
      box-shadow:0 0 0 1px var(--spn-yellow);
      border-color:var(--spn-yellow);
    }

    /* 搜尋列 */
    .search-form{
      flex:1 1 auto;
      max-width:640px;
    }
    .search-box{
      background:#fff;border-radius:4px;overflow:hidden;
      display:flex;align-items:center;border:0;
      box-shadow:0 1px 3px rgba(0,0,0,.25);
    }
    .search-category{
      border:0;
      background:#f3f4f6;
      padding:.45rem .75rem;
      font-size:.85rem;
      display:flex;
      align-items:center;
      gap:.25rem;
      white-space:nowrap;
    }
    .search-category i{
      font-size:.7rem;
    }
    .search-box input{
      border:0;padding:.45rem .75rem;flex:1;min-width:160px;
      font-size:.85rem;
    }
    .search-box input:focus{outline:none;box-shadow:none;}
    .search-box .btn-search{
      background:var(--spn-orange);color:#fff;border:0;
      width:44px;display:flex;align-items:center;justify-content:center;
      font-size:1rem;
    }

    .nav-right-group{
      display:flex;
      align-items:center;
      gap:1rem;
      font-size:.85rem;
      white-space:nowrap;
    }
    .nav-right-link{
      color:#f9fafb;
      text-decoration:none;
    }
    .nav-right-link:hover{
      color:var(--spn-yellow);
      text-decoration:underline;
    }
    .nav-btn-primary{
      background:var(--spn-orange);
      border:0;
      color:#111827;
      padding:.35rem 1.1rem;
      border-radius:999px;
      font-size:.8rem;
      font-weight:600;
    }
    .nav-btn-primary:hover{
      background:#ffa41c;
      color:#111827;
    }

    @media (max-width: 768px){
      .nav-right-group{display:none;}
      .nav-left-group{gap:.75rem;}
      .search-form{max-width:none;}
    }

    /* ========= HERO ORANGE BANNER ========= */
    .hero-banner{
      background:var(--spn-orange-strong);
      padding:24px 0 40px;
    }
    .hero-banner-inner{
      max-width:1100px;
      margin:0 auto;
    }

    .hero-carousel{
      border-radius:18px;
      overflow:hidden;
      box-shadow:0 18px 40px rgba(0,0,0,.45);
      background:#fff;
    }
    .hero-carousel .carousel-item{
      min-height:260px;
      background:#fff;
      position:relative;
      color:#111827;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .hero-carousel-content{
      padding:2.2rem 2rem;
      text-align:left;
      width:100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:2rem;
    }
    .hero-text{
      max-width:520px;
    }
    .hero-text h2{
      font-size:1.6rem;
      font-weight:800;
      margin-bottom:.5rem;
    }
    .hero-text p{
      margin-bottom:.4rem;
      font-size:.95rem;
      color:#374151;
    }
    .hero-tagline{
      font-size:.8rem;
      color:#6b7280;
    }
    .hero-illus{
      flex:0 0 220px;
      max-width:260px;
      text-align:center;
    }
    .hero-illus-placeholder{
      width:100%;
      aspect-ratio:4/3;
      border-radius:20px;
      background:linear-gradient(135deg,#f97316,#facc15);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-size:1.1rem;
      font-weight:600;
    }

    .carousel-indicators [data-bs-target]{
      width:7px;height:7px;border-radius:999px;
    }
    .carousel-indicators .active{
      background-color:#111827;
    }

    .hero-eyebrow-small{
      font-size:.75rem;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:#9ca3af;
      margin-bottom:.2rem;
    }

    /* ========= Categories ========= */
    .category-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
      gap:1rem;margin-top:2rem;
    }
    .category-card{
      background:#fff;border-radius:10px;
      padding:1rem .9rem;border:1px solid #e5e7eb;
      box-shadow:0 2px 8px rgba(15,23,42,.04);
      cursor:pointer;transition:.15s;
      display:flex;flex-direction:column;gap:.25rem;
    }
    .category-card:hover{
      transform:translateY(-2px);
      box-shadow:0 5px 16px rgba(15,23,42,.12);
      border-color:var(--spn-orange);
    }
    .category-icon{
      background:var(--spn-orange);color:#fff;border-radius:999px;
      width:40px;height:40px;display:flex;align-items:center;
      justify-content:center;font-size:1.3rem;margin-bottom:.3rem;
    }
    .category-name{font-weight:600;font-size:.95rem;}
    .category-desc{color:#6b7280;font-size:.8rem;line-height:1.4;}

    /* ========= Providers List ========= */
    .provider-card{
      background:#fff;border:1px solid #e5e7eb;border-radius:10px;
      padding:1rem;cursor:pointer;transition:.18s;
      box-shadow:0 2px 8px rgba(15,23,42,.04);
      height:100%;
    }
    .provider-card:hover{
      transform:translateY(-2px);
      box-shadow:0 6px 18px rgba(15,23,42,.12);
      border-color:var(--spn-orange);
    }

    /* ========= Detail Page ========= */
    .detail-card{
      background:white;border-radius:12px;
      border:1px solid #e5e7eb;padding:2rem;
      box-shadow:0 4px 18px rgba(15,23,42,.08);
    }

    /* Level 2 子類別選項置中 */
    #subTypeNav{
      display:flex;
      justify-content:center !important;
      width:100%;
    }
  </style>
</head>

<body>

<!-- ========= NAV ========= -->
<nav class="headbar">
  <div class="container d-flex align-items-center justify-content-between gap-3">
    <div class="nav-left-group">
      <div class="brand-logo">amazon<span>spn</span></div>
      <div class="site-select-wrapper">
        <i class="bi bi-globe2 site-select-icon"></i>
        <select id="siteSelect" class="form-select form-select-sm site-select-control">
          <option value="北美站" selected>選擇站點：北美站</option>
          <option value="歐洲站">選擇站點：歐洲站</option>
          <option value="日本站">選擇站點：日本站</option>
          <option value="澳洲/新加坡">選擇站點：澳洲 / 新加坡</option>
          <option value="中東站">選擇站點：中東站</option>
        </select>
      </div>
    </div>

    <form id="searchForm" class="d-flex search-form">
      <div class="search-box flex-grow-1">
        <button type="button" class="search-category">
          服務商 <i class="bi bi-caret-down-fill"></i>
        </button>
        <input id="searchInput" type="search" placeholder="輸入關鍵字搜索" />
        <button class="btn-search" type="submit"><i class="bi bi-search"></i></button>
      </div>
    </form>

    <div class="nav-right-group">
      <a href="#" class="nav-right-link">了解如何成為服務商</a>
      <button type="button" class="nav-btn-primary">登入或註冊</button>
    </div>
  </div>
</nav>

<!-- ========= ORANGE HERO BANNER ========= -->
<section class="hero-banner">
  <div class="hero-banner-inner">
    <div id="heroCarousel" class="carousel slide hero-carousel" data-bs-ride="carousel">
      <div class="carousel-indicators">
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active" aria-current="true"></button>
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1"></button>
        <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2"></button>
      </div>
      <div class="carousel-inner">
        <div class="carousel-item active">
          <div class="hero-carousel-content">
            <div class="hero-text">
              <div class="hero-eyebrow-small">SERVICE PROVIDER NETWORK</div>
              <h2>依服務範疇與站點，快速找到合作服務商</h2>
              <p>本平台由內部維護，定期更新服務商資訊。你只要根據需求與目標站點搜尋，就能找到合適的營運、廣告、設計、物流等合作夥伴。</p>
              <div class="hero-tagline">資料每日由內部維護，對外無法編輯。如需更新，請聯繫內部窗口。</div>
            </div>
            <div class="hero-illus">
              <div class="hero-illus-placeholder">
                Banner<br/>示意區
              </div>
            </div>
          </div>
        </div>

        <div class="carousel-item">
          <div class="hero-carousel-content">
            <div class="hero-text">
              <div class="hero-eyebrow-small">GROW YOUR GLOBAL BUSINESS</div>
              <h2>從選品、上架、廣告到合規，一站式找到專業夥伴</h2>
              <p>針對不同成長階段的賣家，瀏覽各式服務類別與標籤，找到最適合你的專業團隊，加速拓展海外市場。</p>
              <div class="hero-tagline">建議先選擇站點與服務類別，再依子類與關鍵字縮小結果。</div>
            </div>
            <div class="hero-illus">
              <div class="hero-illus-placeholder">
                成長<br/>方案
              </div>
            </div>
          </div>
        </div>

        <div class="carousel-item">
          <div class="hero-carousel-content">
            <div class="hero-text">
              <div class="hero-eyebrow-small">MULTI-MARKET STRATEGY</div>
              <h2>一次規劃多國市場，整合物流、稅務與在地營運</h2>
              <p>結合同一服務商在多站點的服務能力，便於統一協作、集中溝通，降低跨市場營運的複雜度。</p>
              <div class="hero-tagline">可搭配「可服務站點」條件，鎖定支援多站點的合作夥伴。</div>
            </div>
            <div class="hero-illus">
              <div class="hero-illus-placeholder">
                多站點<br/>佈局
              </div>
            </div>
          </div>
        </div>
      </div>

      <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
      </button>
    </div>
  </div>
</section>

<!-- ========= LEVEL 1: Categories ========= -->
<section id="level1" class="py-4">
  <div class="container">
    <h3 class="text-center mb-3">依服務類型尋找合作夥伴</h3>
    <p class="text-center text-muted" style="font-size:.9rem;">
      先選擇服務大類，再依子類與站點條件縮小服務商列表。
    </p>
    <div id="serviceCategories" class="category-grid"></div>
  </div>
</section>

<!-- ========= LEVEL 2: Provider List ========= -->
<section id="level2" style="display:none;">
  <div class="container py-4">
    <button class="btn btn-outline-primary mb-3" onclick="showLevel1()">
      <i class="bi bi-arrow-left"></i> 返回
    </button>

    <h3 id="level2Title" class="mb-3"></h3>

    <nav id="subTypeNav" class="nav nav-pills mb-3 gap-2"></nav>

    <div id="providersList" class="row g-3"></div>
  </div>
</section>

<!-- ========= LEVEL 3: Detail Page ========= -->
<section id="level3" style="display:none;">
  <div class="container py-4">
    <button class="btn btn-outline-primary mb-3" onclick="showLevel2()">
      <i class="bi bi-arrow-left"></i> 返回
    </button>

    <div id="providerDetail"></div>
  </div>
</section>

<footer class="text-center py-3 text-muted" style="font-size:.78rem;">
  © 2025 Service Provider Portal. All Rights Reserved.
</footer>

<!-- JS libraries -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
/* ========= 全域變數 ========= */
let providers = [];
let providerMap = {};
let categories = [];
let categoryMap = {};
let currentCategory = null;
let currentSubType = null;
let currentSite = null;     // 目前站點
let lastSearchQuery = "";
let siteSelect = null;

/* ========= DOM ========= */
const level1 = document.getElementById("level1");
const level2 = document.getElementById("level2");
const level3 = document.getElementById("level3");
const statProviders = document.getElementById("statProviders");
const statTypes = document.getElementById("statTypes");
const serviceCategories = document.getElementById("serviceCategories");
const providersList = document.getElementById("providersList");
const level2Title = document.getElementById("level2Title");
const subTypeNav = document.getElementById("subTypeNav");
const providerDetail = document.getElementById("providerDetail");

/* ========= 小工具 ========= */
function truthyFlag(v){
  if(v === undefined || v === null) return false;
  const s = String(v).trim().toLowerCase();
  if(!s) return false;
  return !["0","n","no","false","未提供","x"].includes(s);
}

function matchesSite(p){
  if(!currentSite) return true;           // 理論上一定有值，但保險留著
  if(!p.regions || !p.regions.length) return false;
  return p.regions.includes(currentSite);
}

/* 類型名稱 → icon class */
function getCategoryIcon(name){
  if(!name) return "bi-grid-1x2";
  if(/帳戶|開店|入駐|註冊/.test(name)) return "bi-person-badge";
  if(/代營運|營運|顧問|策略/.test(name)) return "bi-graph-up-arrow";
  if(/廣告|投放|站內/.test(name)) return "bi-bullseye";
  if(/設計|美工|圖片|視覺/.test(name)) return "bi-brush";
  if(/品牌|行銷|行销/.test(name)) return "bi-megaphone";
  if(/物流|倉儲|倉庫|貨運/.test(name)) return "bi-truck";
  if(/稅務|VAT|會計/.test(name)) return "bi-receipt-cutoff";
  if(/客服|語言|翻譯/.test(name)) return "bi-chat-dots";
  if(/培訓|課程|教育/.test(name)) return "bi-mortarboard";
  return "bi-grid-1x2";
}

/* ========= 畫面切換 ========= */
function showLevel1(){
  level1.style.display = "block";
  level2.style.display = "none";
  level3.style.display = "none";
  currentCategory = null;
}

function showLevel2(){
  level1.style.display = "none";
  level2.style.display = "block";
  level3.style.display = "none";
}

function showLevel3(){
  level1.style.display = "none";
  level2.style.display = "none";
  level3.style.display = "block";
}

/* ========= 站點切換 ========= */
function setSite(site){
  currentSite = site || null;

  // 同步下拉選單的值
  if(siteSelect && siteSelect.value !== site){
    // 站點選單的 option 文案前面有「選擇站點：」，只比對 value
    siteSelect.value = site;
  }

  if(level3.style.display === "block") return;

  if(level2.style.display === "block"){
    if(level2Title.textContent.startsWith("搜尋結果：") && lastSearchQuery){
      runSearch(true);
    }else if(currentCategory){
      if(currentSubType){
        renderProviderList(filterBySubType(currentSubType));
      }else{
        renderProviderList(filterByCategoryOnly(currentCategory.name));
      }
    }
  }
}

/* ========= Level1：分類卡片 ========= */
function renderCategories(){
  serviceCategories.innerHTML = categories.map(cat => `
    <div class="category-card" data-cat="${cat.name}">
      <div class="category-icon"><i class="bi ${getCategoryIcon(cat.name)}"></i></div>
      <div class="category-name">${cat.name}</div>
      <div class="category-desc">${cat.subTypes.slice(0,3).join("、")}</div>
    </div>
  `).join("");

  document.querySelectorAll(".category-card").forEach(card=>{
    card.addEventListener("click",()=>goToCategory(card.dataset.cat));
  });
}

/* ========= Level2：進入某一大類 ========= */
function goToCategory(name){
  currentCategory = categoryMap[name];
  currentSubType = null;
  lastSearchQuery = "";

  level2Title.textContent = `${name} 服務商`;
  showLevel2();

  subTypeNav.innerHTML = "";
  if(currentCategory.subTypes.length){
    currentCategory.subTypes.forEach((sub, idx)=>{
      const tab = document.createElement("button");
      tab.className = "nav-link" + (idx===0 ? " active" : "");
      tab.textContent = sub;
      tab.addEventListener("click", ()=>{
        document.querySelectorAll("#subTypeNav .nav-link").forEach(x=>x.classList.remove("active"));
        tab.classList.add("active");
        currentSubType = sub;
        renderProviderList(filterBySubType(currentSubType));
      });
      subTypeNav.appendChild(tab);
    });
    currentSubType = currentCategory.subTypes[0];
    renderProviderList(filterBySubType(currentSubType));
  }else{
    renderProviderList(filterByCategoryOnly(name));
  }
}

function filterBySubType(sub){
  return providers.filter(p => matchesSite(p) && p.tags.includes(sub));
}

function filterByCategoryOnly(cat){
  const c = categoryMap[cat];
  if(!c || !c.subTypes.length){
    return providers.filter(p => matchesSite(p));
  }
  return providers.filter(p =>
    matchesSite(p) &&
    p.tags.some(t => c.subTypes.includes(t))
  );
}

/* ========= Level2：服務商列表 ========= */
function renderProviderList(list){
  if(!list.length){
    providersList.innerHTML = `<div class="col-12 text-muted">目前無符合條件的服務商。</div>`;
    return;
  }
  providersList.innerHTML = list.map(p => `
    <div class="col-12 col-md-6">
      <div class="provider-card" data-name="${p.name}">
        <h5>${p.name}</h5>
        <div class="text-danger mb-1">${p.tags.join("、")}</div>
        <p class="text-muted small">
          ${p.description ? (p.description.length>100 ? p.description.slice(0,100)+"…" : p.description) : ""}
        </p>
        <div><small class="text-primary">${p.regions.join("、")}</small></div>
      </div>
    </div>
  `).join("");

  document.querySelectorAll(".provider-card").forEach(card=>{
    card.addEventListener("click",()=>openProviderDetail(card.dataset.name));
  });
}

/* ========= Level3：詳細頁 ========= */
function openProviderDetail(name){
  const p = providerMap[name];
  if(!p) return;
  showLevel3();

  const servicesHTML = p.services.map(s =>
    `<li><i class="bi bi-check-circle text-success me-2"></i>${s}</li>`
  ).join("");

  providerDetail.innerHTML = `
    <div class="detail-card">
      <h2>${p.name}</h2>
      <p class="text-muted">${p.description || ""}</p>
      <hr>
      <h5>聯絡資訊</h5>
      <p><strong>聯絡人：</strong>${p.contact || "未提供"}</p>
      <p><strong>電話：</strong>${p.phone || "未提供"}</p>
      <p><strong>Email：</strong>${p.email || "未提供"}</p>
      <p><strong>Line：</strong>${p.lineId || "未提供"}</p>

      <h5 class="mt-4">可服務站點</h5>
      <p>${p.regions.join("、") || "未標註"}</p>

      ${servicesHTML ? `
        <h5 class="mt-4">服務內容</h5>
        <ul>${servicesHTML}</ul>
      ` : ""}

      ${p.website ? `
        <h5 class="mt-4">官網</h5>
        <p><a href="${p.website}" target="_blank">${p.website}</a></p>
      ` : ""}
    </div>
  `;
}

/* ========= 搜尋 ========= */
function runSearch(fromSiteChange){
  const q = document.getElementById("searchInput").value.trim().toLowerCase();
  lastSearchQuery = q;
  if(!q){
    showLevel1();
    return;
  }
  showLevel2();
  level2Title.textContent = `搜尋結果：「${q}」`;
  subTypeNav.innerHTML = "";

  const list = providers.filter(p=>{
    if(!matchesSite(p)) return false;
    const hay = [
      p.name, p.description,
      p.tags.join(" "),
      p.services.join(" ")
    ].join(" ").toLowerCase();
    return hay.includes(q);
  });
  renderProviderList(list);
}

/* ========= 載入 providers.csv ========= */
function loadProviders(){
  Papa.parse("providers.csv",{
    download:true,
    header:true,
    skipEmptyLines:true,
    complete:(res)=>{
      const rows = res.data || [];
      if(!rows.length) return;

      const headers = Object.keys(rows[0]);
      const nameKey  = headers.find(h => /公司名稱|公司|Name/i.test(h)) || headers[0];
      const contactKey = headers.find(h => /聯絡|Contact/i.test(h));
      const phoneKey   = headers.find(h => /電話|Phone/i.test(h));
      const emailKey   = headers.find(h => /email/i.test(h));
      const lineKey    = headers.find(h => /line/i.test(h));
      const logoKey    = headers.find(h => /logo/i.test(h));
      const descKey    = headers.find(h => /介紹|Description/i.test(h));
      const webKey     = headers.find(h => /官網|Website/i.test(h));
      const typeKey    = headers.find(h => /服務類型|類別|Type|Tag/i.test(h));
      const svc1Key    = headers.find(h => /服務內容1/i.test(h));
      const svc2Key    = headers.find(h => /服務內容2/i.test(h));
      const svc3Key    = headers.find(h => /服務內容3/i.test(h));

      providers = rows.map(r=>{
        const name = (r[nameKey] || "").toString().trim();
        if(!name) return null;

        const tags = (r[typeKey] || "")
          .toString()
          .split(/[、,，;；\/]/)
          .map(s=>s.trim()).filter(Boolean);

        const regions = [];
        if(truthyFlag(r["北美站"])) regions.push("北美站");
        if(truthyFlag(r["歐洲站"])) regions.push("歐洲站");
        if(truthyFlag(r["日本站"])) regions.push("日本站");
        if(truthyFlag(r["澳洲/新加坡"])) regions.push("澳洲/新加坡");
        if(truthyFlag(r["中東站"])) regions.push("中東站");

        return {
          name,
          contact: contactKey ? (r[contactKey] || "") : "",
          phone:   phoneKey   ? (r[phoneKey]   || "") : "",
          email:   emailKey   ? (r[emailKey]   || "") : "",
          lineId:  lineKey    ? (r[lineKey]    || "") : "",
          logo:    logoKey    ? (r[logoKey]    || "") : "",
          description: descKey ? (r[descKey]   || "") : "",
          website: webKey     ? (r[webKey]     || "") : "",
          tags,
          services: [svc1Key && r[svc1Key], svc2Key && r[svc2Key], svc3Key && r[svc3Key]]
                      .filter(x=>x && String(x).trim()),
          regions
        };
      }).filter(Boolean);

      providers.forEach(p=>providerMap[p.name] = p);
      if(statProviders) statProviders.textContent = providers.length;
    },
    error:(err)=>console.error("providers.csv 讀取失敗",err)
  });
}

/* ========= 載入 hierarchy.csv ========= */
function loadHierarchy(){
  Papa.parse("hierarchy.csv",{
    download:true,
    header:true,
    skipEmptyLines:true,
    complete:(res)=>{
      const rows = res.data || [];
      const map = new Map();
      rows.forEach(r=>{
        const vals = Object.values(r).map(v=>String(v||"").trim());
        const parent = vals[0];
        if(!parent) return;
        if(!map.has(parent)) map.set(parent,new Set());
        vals.slice(1).forEach(v=>{ if(v) map.get(parent).add(v); });
      });

      categories = Array.from(map.keys()).map(k=>({
        name:k,
        subTypes:Array.from(map.get(k))
      }));
      categories.forEach(c=>categoryMap[c.name] = c);
      if(statTypes) statTypes.textContent = categories.length;
      renderCategories();
    },
    error:(err)=>console.error("hierarchy.csv 讀取失敗",err)
  });
}

/* ========= 初始化 ========= */
document.addEventListener("DOMContentLoaded",()=>{
  document.getElementById("searchForm").addEventListener("submit",e=>{
    e.preventDefault();
    runSearch(false);
  });

  siteSelect = document.getElementById("siteSelect");
  if(siteSelect){
    siteSelect.addEventListener("change",()=>{
      const site = siteSelect.value.replace("選擇站點：","");
      setSite(site);
    });
    // 預設使用 select 裡的值（北美站）
    setSite("北美站");
  }else{
    setSite("北美站");
  }

  loadProviders();
  loadHierarchy();
});
</script>

</body>
</html>
