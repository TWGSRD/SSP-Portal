<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>服務商網路平台 | Service Provider Portal</title>

  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --deep-orange:#ff6403;
      --ink-blue:#161d26;
      --border-light:#e5e7eb;
      --site-pill-bg:rgba(255,255,255,.08);
      --site-pill-border:rgba(255,255,255,.4);
    }
    body{
      background:#f8f9fa;
      font-family:'PingFang TC','Microsoft JhengHei',sans-serif;
    }

    /* ========= NAV (Black Bar) ========= */
    .headbar{background:#000;color:#fff;padding:8px 0;}
    .headbar .brand-title{font-weight:700;font-size:1.1rem;}

    .search-box{
      background:#fff;border-radius:8px;overflow:hidden;
      display:flex;align-items:center;border:1px solid #2b3542;
    }
    .search-box input{
      border:0;padding:.55rem .8rem;flex:1;min-width:220px;
    }
    .search-box .btn-search{
      background:var(--deep-orange);color:#fff;border:0;
      width:44px;display:flex;align-items:center;justify-content:center;
    }

    /* ========= HERO ========= */
    .hero-section{
      background:linear-gradient(135deg,#232f3e,#37475a);
      color:white;padding:3rem 0 3rem;
    }
    .hero-section h1{font-size:2.2rem;font-weight:700;}
    .hero-section p{opacity:.9;font-size:1.05rem;}

    .hero-stats{
      background:rgba(255,255,255,.08);
      padding:1.1rem;border-radius:10px;margin-top:1.2rem;
      font-size:.85rem;
      /* ✨ 不顯示統計卡片 */
      display:none;
    }

    .site-filter-bar{
      margin-top:1.2rem;
      display:flex;
      flex-wrap:wrap;
      justify-content:flex-start;
      gap:.4rem;
      font-size:.8rem;
    }
    .site-filter{
      border-radius:999px;
      border:1px solid var(--site-pill-border);
      background:var(--site-pill-bg);
      color:#f9fafb;
      padding:.25rem .75rem;
      cursor:pointer;
    }
    .site-filter.active{
      background:#ffd814;
      color:#111827;
      border-color:#ffd814;
      font-weight:600;
    }

    /* ========= Carousel ========= */
    .hero-carousel{
      border-radius:16px;
      overflow:hidden;
      box-shadow:0 8px 24px rgba(0,0,0,.35);
      background:#111827;
    }
    .hero-carousel .carousel-item{
      min-height:340px; /* ✨ 放大 banner 高度 */
      background-size:cover;
      background-position:center;
      position:relative;
      color:#f9fafb;
    }
    .hero-carousel .carousel-item::after{
      content:"";
      position:absolute;inset:0;
      background:linear-gradient(135deg,rgba(0,0,0,.75),rgba(15,23,42,.3));
    }
    .hero-carousel-content{
      position:relative;
      z-index:2;
      padding:1.75rem 1.75rem 1.5rem;
    }
    .hero-badge{
      display:inline-flex;
      align-items:center;
      gap:.35rem;
      font-size:.75rem;
      background:rgba(255,255,255,.12);
      padding:.25rem .7rem;
      border-radius:999px;
    }
    .hero-carousel h5{
      font-size:1.1rem;
      margin-top:.6rem;
      margin-bottom:.4rem;
    }
    .hero-carousel p{
      font-size:.85rem;
      opacity:.9;
      margin-bottom:.6rem;
    }

    /* ========= Categories ========= */
    .category-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
      gap:1rem;margin-top:2rem;
    }
    .category-card{
      background:#fff;border-radius:8px;
      padding:1rem;border:1px solid #e5e7eb;
      box-shadow:0 2px 8px rgba(0,0,0,.05);
      cursor:pointer;transition:.15s;
      display:flex;flex-direction:column;gap:.25rem;
    }
    .category-card:hover{
      transform:translateY(-3px);
      box-shadow:0 4px 14px rgba(0,0,0,.12);
      border-color:#ff9900;
    }
    .category-icon{
      background:#ff9900;color:#fff;border-radius:999px;
      width:40px;height:40px;display:flex;align-items:center;
      justify-content:center;font-size:1.3rem;margin-bottom:.3rem;
    }
    .category-name{font-weight:600;font-size:.95rem;}
    .category-desc{color:#6b7280;font-size:.8rem;}

    /* ========= Providers List ========= */
    .provider-card{
      background:#fff;border:1px solid #e5e7eb;border-radius:10px;
      padding:1rem;cursor:pointer;transition:.2s;
      box-shadow:0 2px 8px rgba(0,0,0,.05);
      height:100%;
    }
    .provider-card:hover{
      transform:translateY(-3px);
      box-shadow:0 6px 16px rgba(0,0,0,.1);
    }

    /* ========= Detail Page ========= */
    .detail-card{
      background:white;border-radius:12px;
      border:1px solid #e5e7eb;padding:2rem;
      box-shadow:0 3px 12px rgba(0,0,0,.06);
    }
  </style>
</head>

<body>

<!-- ========= NAV ========= -->
<nav class="headbar">
  <div class="container d-flex align-items-center justify-content-between">
    <div class="brand-title">Service Provider Portal</div>

    <form id="searchForm" class="d-flex" style="max-width:360px;width:100%;">
      <div class="search-box flex-grow-1">
        <input id="searchInput" type="search" placeholder="搜尋公司名稱、服務、介紹..." />
        <button class="btn-search" type="submit"><i class="bi bi-search"></i></button>
      </div>
    </form>
  </div>
</nav>

<!-- ========= HERO ========= -->
<section class="hero-section">
  <div class="container">
    <div class="row g-4 align-items-stretch">
      <div class="col-lg-6">
        <h1>服務商網路平台</h1>
        <p>依據服務類型與目標站點，快速找到適合的專業服務商，支援你在不同市場拓展生意。</p>

        <div class="hero-stats">
          <div class="row">
            <div class="col-6 text-center">
              <div id="statProviders" class="h3 mb-0">0</div>
              <small>服務商數量</small>
            </div>
            <div class="col-6 text-center">
              <div id="statTypes" class="h3 mb-0">0</div>
              <small>服務類型</small>
            </div>
          </div>
        </div>

        <!-- 站點選擇 -->
        <div class="site-filter-bar mt-3">
          <span class="me-1">目標站點：</span>
          <button class="site-filter active" data-site="">全部</button>
          <button class="site-filter" data-site="北美站">北美站</button>
          <button class="site-filter" data-site="歐洲站">歐洲站</button>
          <button class="site-filter" data-site="日本站">日本站</button>
          <button class="site-filter" data-site="澳洲/新加坡">澳洲/新加坡</button>
          <button class="site-filter" data-site="中東站">中東站</button>
        </div>
      </div>

      <div class="col-lg-6">
        <!-- Banner Carousel -->
        <div id="heroCarousel" class="carousel slide hero-carousel" data-bs-ride="carousel">
          <div class="carousel-indicators">
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active" aria-current="true"></button>
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1"></button>
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2"></button>
          </div>
          <div class="carousel-inner">
            <div class="carousel-item active">
              <div class="hero-carousel-content">
                <div class="hero-badge"><i class="bi bi-rocket-takeoff"></i><span>新手賣家啟動</span></div>
                <h5>從 0 到 1 建立跨境店鋪</h5>
                <p>找代營運、顧問與培訓夥伴，協助你完成選品、開店、上架與首波投放。</p>
                <small>建議服務類型：帳戶註冊、代營運、營運顧問、培訓課程</small>
              </div>
            </div>
            <div class="carousel-item">
              <div class="hero-carousel-content">
                <div class="hero-badge"><i class="bi bi-graph-up-arrow"></i><span>成長與優化</span></div>
                <h5>提升廣告投報與轉換率</h5>
                <p>透過專業廣告代理、視覺設計、品牌顧問優化店鋪與商品頁，提升營收。</p>
                <small>建議服務類型：站內廣告、視覺設計、品牌顧問</small>
              </div>
            </div>
            <div class="carousel-item">
              <div class="hero-carousel-content">
                <div class="hero-badge"><i class="bi bi-globe2"></i><span>多站點佈局</span></div>
                <h5>一次規劃多國市場策略</h5>
                <p>結合稅務、物流與本地化營運服務，協助你拓展至北美、歐洲、日本等市場。</p>
                <small>建議服務類型：跨境物流、VAT 稅務、當地語言客服</small>
              </div>
            </div>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ========= LEVEL 1: Categories ========= -->
<section id="level1" class="py-4">
  <div class="container">
    <h3 class="text-center mb-3">依服務類型尋找合作夥伴</h3>
    <p class="text-center text-muted" style="font-size:.9rem;">
      先選擇服務大類，再依子類與站點條件縮小服務商列表。
    </p>
    <div id="serviceCategories" class="category-grid"></div>
  </div>
</section>


<!-- ========= LEVEL 2: Provider List ========= -->
<section id="level2" style="display:none;">
  <div class="container py-4">
    <button class="btn btn-outline-primary mb-3" onclick="showLevel1()">
      <i class="bi bi-arrow-left"></i> 返回
    </button>

    <h3 id="level2Title" class="mb-3"></h3>

    <nav id="subTypeNav" class="nav nav-pills mb-3 gap-2"></nav>

    <div id="providersList" class="row g-3"></div>
  </div>
</section>

<!-- ========= LEVEL 3: Detail Page ========= -->
<section id="level3" style="display:none%;">
  <div class="container py-4">
    <button class="btn btn-outline-primary mb-3" onclick="showLevel2()">
      <i class="bi bi-arrow-left"></i> 返回
    </button>

    <div id="providerDetail"></div>
  </div>
</section>

<footer class="text-center py-3 text-muted">
  © 2025 Service Provider Portal
</footer>

<!-- JS libraries -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<script>
/* ========= 全域變數 ========= */
let providers = [];
let providerMap = {};
let categories = [];
let categoryMap = {};
let currentCategory = null;
let currentSubType = null;
let currentSite = null;     // 目前站點（null = 全部）
let lastSearchQuery = "";

/* ========= DOM ========= */
const level1 = document.getElementById("level1");
const level2 = document.getElementById("level2");
const level3 = document.getElementById("level3");
const statProviders = document.getElementById("statProviders");
const statTypes = document.getElementById("statTypes");
const serviceCategories = document.getElementById("serviceCategories");
const providersList = document.getElementById("providersList");
const level2Title = document.getElementById("level2Title");
const subTypeNav = document.getElementById("subTypeNav");
const providerDetail = document.getElementById("providerDetail");

/* ========= 小工具 ========= */
function truthyFlag(v){
  if(v === undefined || v === null) return false;
  const s = String(v).trim().toLowerCase();
  if(!s) return false;
  return !["0","n","no","false","未提供","x"].includes(s);
}

function matchesSite(p){
  if(!currentSite) return true;
  if(!p.regions || !p.regions.length) return false;
  return p.regions.includes(currentSite);
}

/* 類型名稱 → icon class */
function getCategoryIcon(name){
  if(!name) return "bi-grid-1x2";
  if(/帳戶|開店|入駐|註冊/.test(name)) return "bi-person-badge";
  if(/代營運|營運|顧問|策略/.test(name)) return "bi-graph-up-arrow";
  if(/廣告|投放|站內/.test(name)) return "bi-bullseye";
  if(/設計|美工|圖片|視覺/.test(name)) return "bi-brush";
  if(/品牌|行銷|行销/.test(name)) return "bi-megaphone";
  if(/物流|倉儲|倉庫|貨運/.test(name)) return "bi-truck";
  if(/稅務|VAT|會計/.test(name)) return "bi-receipt-cutoff";
  if(/客服|語言|翻譯/.test(name)) return "bi-chat-dots";
  if(/培訓|課程|教育/.test(name)) return "bi-mortarboard";
  return "bi-grid-1x2";
}

/* ========= 畫面切換 ========= */
function showLevel1(){
  level1.style.display = "block";
  level2.style.display = "none";
  level3.style.display = "none";
  currentCategory = null;
}

function showLevel2(){
  level1.style.display = "none";
  level2.style.display = "block";
  level3.style.display = "none";
}

function showLevel3(){
  level1.style.display = "none";
  level2.style.display = "none";
  level3.style.display = "block";
}

/* ========= 站點切換 ========= */
function setSite(site){
  currentSite = site || null;
  document.querySelectorAll(".site-filter").forEach(btn=>{
    const s = btn.getAttribute("data-site") || "";
    btn.classList.toggle("active", s === (site || ""));
  });

  if(level3.style.display === "block") return;

  if(level2.style.display === "block"){
    if(level2Title.textContent.startsWith("搜尋結果：") && lastSearchQuery){
      runSearch(true);
    }else if(currentCategory){
      if(currentSubType){
        renderProviderList(filterBySubType(currentSubType));
      }else{
        renderProviderList(filterByCategoryOnly(currentCategory.name));
      }
    }
  }
}

/* ========= Level1：分類卡片 ========= */
function renderCategories(){
  serviceCategories.innerHTML = categories.map(cat => `
    <div class="category-card" data-cat="${cat.name}">
      <div class="category-icon"><i class="bi ${getCategoryIcon(cat.name)}"></i></div>
      <div class="category-name">${cat.name}</div>
      <div class="category-desc">${cat.subTypes.slice(0,3).join("、")}</div>
    </div>
  `).join("");

  document.querySelectorAll(".category-card").forEach(card=>{
    card.addEventListener("click",()=>goToCategory(card.dataset.cat));
  });
}

/* ========= Level2：進入某一大類 ========= */
function goToCategory(name){
  currentCategory = categoryMap[name];
  currentSubType = null;
  lastSearchQuery = "";

  level2Title.textContent = `${name} 服務商`;
  showLevel2();

  subTypeNav.innerHTML = "";
  if(currentCategory.subTypes.length){
    currentCategory.subTypes.forEach((sub, idx)=>{
      const tab = document.createElement("button");
      tab.className = "nav-link" + (idx===0 ? " active" : "");
      tab.textContent = sub;
      tab.addEventListener("click", ()=>{
        document.querySelectorAll("#subTypeNav .nav-link").forEach(x=>x.classList.remove("active"));
        tab.classList.add("active");
        currentSubType = sub;
        renderProviderList(filterBySubType(sub));
      });
      subTypeNav.appendChild(tab);
    });
    currentSubType = currentCategory.subTypes[0];
    renderProviderList(filterBySubType(currentSubType));
  }else{
    renderProviderList(filterByCategoryOnly(name));
  }
}

function filterBySubType(sub){
  return providers.filter(p => matchesSite(p) && p.tags.includes(sub));
}

function filterByCategoryOnly(cat){
  const c = categoryMap[cat];
  if(!c || !c.subTypes.length){
    return providers.filter(p => matchesSite(p));
  }
  return providers.filter(p =>
    matchesSite(p) &&
    p.tags.some(t => c.subTypes.includes(t))
  );
}

/* ========= Level2：服務商列表 ========= */
function renderProviderList(list){
  if(!list.length){
    providersList.innerHTML = `<div class="col-12 text-muted">目前無符合條件的服務商。</div>`;
    return;
  }
  providersList.innerHTML = list.map(p => `
    <div class="col-12 col-md-6">
      <div class="provider-card" data-name="${p.name}">
        <h5>${p.name}</h5>
        <div class="text-danger mb-1">${p.tags.join("、")}</div>
        <p class="text-muted small">
          ${p.description ? (p.description.length>100 ? p.description.slice(0,100)+"…" : p.description) : ""}
        </p>
        <div><small class="text-primary">${p.regions.join("、")}</small></div>
      </div>
    </div>
  `).join("");

  document.querySelectorAll(".provider-card").forEach(card=>{
    card.addEventListener("click",()=>openProviderDetail(card.dataset.name));
  });
}

/* ========= Level3：詳細頁 ========= */
function openProviderDetail(name){
  const p = providerMap[name];
  if(!p) return;
  showLevel3();

  const servicesHTML = p.services.map(s =>
    `<li><i class="bi bi-check-circle text-success me-2"></i>${s}</li>`
  ).join("");

  providerDetail.innerHTML = `
    <div class="detail-card">
      <h2>${p.name}</h2>
      <p class="text-muted">${p.description || ""}</p>
      <hr>
      <h5>聯絡資訊</h5>
      <p><strong>聯絡人：</strong>${p.contact || "未提供"}</p>
      <p><strong>電話：</strong>${p.phone || "未提供"}</p>
      <p><strong>Email：</strong>${p.email || "未提供"}</p>
      <p><strong>Line：</strong>${p.lineId || "未提供"}</p>

      <h5 class="mt-4">可服務站點</h5>
      <p>${p.regions.join("、") || "未標註"}</p>

      ${servicesHTML ? `
        <h5 class="mt-4">服務內容</h5>
        <ul>${servicesHTML}</ul>
      ` : ""}

      ${p.website ? `
        <h5 class="mt-4">官網</h5>
        <p><a href="${p.website}" target="_blank">${p.website}</a></p>
      ` : ""}
    </div>
  `;
}

/* ========= 搜尋 ========= */
function runSearch(fromSiteChange){
  const q = document.getElementById("searchInput").value.trim().toLowerCase();
  lastSearchQuery = q;
  if(!q){
    showLevel1();
    return;
  }
  showLevel2();
  level2Title.textContent = `搜尋結果：「${q}」`;
  subTypeNav.innerHTML = "";

  const list = providers.filter(p=>{
    if(!matchesSite(p)) return false;
    const hay = [
      p.name, p.description,
      p.tags.join(" "),
      p.services.join(" ")
    ].join(" ").toLowerCase();
    return hay.includes(q);
  });
  renderProviderList(list);
}

/* ========= 載入 providers.csv ========= */
function loadProviders(){
  Papa.parse("providers.csv",{
    download:true,
    header:true,
    skipEmptyLines:true,
    complete:(res)=>{
      const rows = res.data || [];
      if(!rows.length) return;

      const headers = Object.keys(rows[0]);
      const nameKey  = headers.find(h => /公司名稱|公司|Name/i.test(h)) || headers[0];
      const contactKey = headers.find(h => /聯絡|Contact/i.test(h));
      const phoneKey   = headers.find(h => /電話|Phone/i.test(h));
      const emailKey   = headers.find(h => /email/i.test(h));
      const lineKey    = headers.find(h => /line/i.test(h));
      const logoKey    = headers.find(h => /logo/i.test(h));
      const descKey    = headers.find(h => /介紹|Description/i.test(h));
      const webKey     = headers.find(h => /官網|Website/i.test(h));
      const typeKey    = headers.find(h => /服務類型|類別|Type|Tag/i.test(h));
      const svc1Key    = headers.find(h => /服務內容1/i.test(h));
      const svc2Key    = headers.find(h => /服務內容2/i.test(h));
      const svc3Key    = headers.find(h => /服務內容3/i.test(h));

      providers = rows.map(r=>{
        const name = (r[nameKey] || "").toString().trim();
        if(!name) return null;

        const tags = (r[typeKey] || "")
          .toString()
          .split(/[、,，;；\/]/)
          .map(s=>s.trim()).filter(Boolean);

        const regions = [];
        if(truthyFlag(r["北美站"])) regions.push("北美站");
        if(truthyFlag(r["歐洲站"])) regions.push("歐洲站");
        if(truthyFlag(r["日本站"])) regions.push("日本站");
        if(truthyFlag(r["澳洲/新加坡"])) regions.push("澳洲/新加坡");
        if(truthyFlag(r["中東站"])) regions.push("中東站");

        return {
          name,
          contact: contactKey ? (r[contactKey] || "") : "",
          phone:   phoneKey   ? (r[phoneKey]   || "") : "",
          email:   emailKey   ? (r[emailKey]   || "") : "",
          lineId:  lineKey    ? (r[lineKey]    || "") : "",
          logo:    logoKey    ? (r[logoKey]    || "") : "",
          description: descKey ? (r[descKey]   || "") : "",
          website: webKey     ? (r[webKey]     || "") : "",
          tags,
          services: [svc1Key && r[svc1Key], svc2Key && r[svc2Key], svc3Key && r[svc3Key]]
                      .filter(x=>x && String(x).trim()),
          regions
        };
      }).filter(Boolean);

      providers.forEach(p=>providerMap[p.name] = p);
      if(statProviders) statProviders.textContent = providers.length;
    },
    error:(err)=>console.error("providers.csv 讀取失敗",err)
  });
}

/* ========= 載入 hierarchy.csv ========= */
function loadHierarchy(){
  Papa.parse("hierarchy.csv",{
    download:true,
    header:true,
    skipEmptyLines:true,
    complete:(res)=>{
      const rows = res.data || [];
      const map = new Map();
      rows.forEach(r=>{
        const vals = Object.values(r).map(v=>String(v||"").trim());
        const parent = vals[0];
        if(!parent) return;
        if(!map.has(parent)) map.set(parent,new Set());
        vals.slice(1).forEach(v=>{ if(v) map.get(parent).add(v); });
      });

      categories = Array.from(map.keys()).map(k=>({
        name:k,
        subTypes:Array.from(map.get(k))
      }));
      categories.forEach(c=>categoryMap[c.name] = c);
      if(statTypes) statTypes.textContent = categories.length;
      renderCategories();
    },
    error:(err)=>console.error("hierarchy.csv 讀取失敗",err)
  });
}

/* ========= 初始化 ========= */
document.addEventListener("DOMContentLoaded",()=>{
  document.getElementById("searchForm").addEventListener("submit",e=>{
    e.preventDefault();
    runSearch(false);
  });

  document.querySelectorAll(".site-filter").forEach(btn=>{
    btn.addEventListener("click",()=>{
      const site = btn.getAttribute("data-site") || "";
      setSite(site);
    });
  });

  setSite("");          // 預設「全部站點」
  loadProviders();
  loadHierarchy();
});
</script>

</body>
</html>

